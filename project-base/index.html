<!DOCTYPE html>

<head>

    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Corporate Network Visualizer</title>

</head>

<body>

<div align='center' id="d3_selectable_force_directed_graph" style="width: 960px; height: 500px; margin-right: 250px; margin-top: 30px; margin-left: 350px; float: middle; margin-bottom: 12px; position: absolute;" >
    <svg></svg>
<div align='center' id="FilterButtons" style="vertical-align: bottom; margin: auto;">
        <input type="number" min="0" max="1" id="num"/>
        <button onclick="filteringGraph()" id= "graphFilter" class="btn btn-primary btn-success"><span class="glyphicon glyphicon-filter"></span></button>

    </div>
</div>

<div id="content" style="bottom: 0px; position: absolute;">
    <div id="searchfield" >
        <form>
            <input  type="text" name="currency" class="biginput" id="autocomplete" value="">

        </form>
    </div><!-- @end #searchfield -->
</div><!-- @end #content -->

<div  class="left" align="left" style="vertical-align: top; float: left; margin-top: 30px; width: 350px; margin-left: 10px">
    
    <h2>PARTNERS</h2>
    <ul id="myList" style="margin-right: 50px; width: 350px; overflow: scroll; -webkit-overflow-scrolling: touch; max-height: 480px; padding-left: 0px ">

    </ul>
</div>

<div  class="right" align="right" style="vertical-align: top; float: right; margin-top: 10px; width: 200px; text-align: center; margin-top: 30px; margin-right: 10px">
    <table class="table table-dark table-striped">
            <thead>
            <th> INFO </th>
            </thead>
            <tr>
                <td id ="isim"> NAME </td>
            </tr>
            <tr>
                <td id = "country"> COUNTRY </td>
            </tr>
            <tr>
                <td id ="type"> ACTIVITY TYPE </td>
            </tr>
            <tr>
                <td id ="kac"> # PROJECTS </td>
            </tr>
            <tr>
                <td id ="connections">  # CONNECTIONS </td>
            </tr>
        </table>
</div>


</body>
<!-- ilk link badge 'lerin işe yaraması için. sorun çıkarabilir çünkü bootsrapin farklı versiyonunu içeriyor' -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

<link rel='stylesheet' href='css/forced-directed-graph.css'>
<script src="https://d3js.org/d3.v4.js"></script>
<script src="js/forced-directed-graph.js"></script>

<link rel="stylesheet" type="text/css" media="all" href="css/style.css">
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="js/jquery.autocomplete.min.js"></script>

<script>
    var max = document.getElementById("num").max * 2;
    var filterWeight = 4;
    var isFirstTime = true;
    var filteredNodes = [];
    var nodesToFilter;
   
    function filteringGraph() {

         var svg = d3.select('#d3_selectable_force_directed_graph');

        if(isFirstTime !== true)
            filterWeight = document.getElementById("num").value * 2;
        console.log(filterWeight);
        d3.json('json/database_biggest.json', function(error, graph) {
            graph.nodes.sort(function (a,b) {
               return a.data - b.data;
            });
            //console.log(graph.nodes);
            if (!error) {

                if(filterWeight !== 0)
                    nodesToFilter = Array.apply(null, Array(graph.nodes.length)).map(function () {});

                graph.links = graph.links.filter(function (a) {
                    if(isFirstTime !== false) {
                        if (max < a.weight)
                            max = a.weight;
                    }

                    if(filterWeight !== 0 && a.weight >= filterWeight)
                    {
                        nodesToFilter[a.source-1] = 1;
                        nodesToFilter[a.target-1] = 1;
                    }
                    return a.weight >= filterWeight;

                });
                //console.log(nodesToFilter);

                if( filterWeight !== 0) {
                    filteredNodes = [];

                    for (var k = 0; k < graph.nodes.length; k++) {
                        if (nodesToFilter[k] === 1)
                            filteredNodes.push(graph.nodes[k]);

                    }
                    //console.log(filteredNodes);

                    graph.nodes = filteredNodes;
                }

                createV4SelectableForceDirectedGraph(svg, graph);

                if(isFirstTime) {
                    document.getElementById("num").max = max / 2;
                    isFirstTime = false;
                }

            } else {
                console.error(error);
            }
        });
    }
    filteringGraph();
</script> 
